<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Demo Wallet — Sandbox</title>
<style>
  :root{--bg:#0b0f1a;--card:#0f1724;--muted:#9aa6bf;--accent:#1db954;--danger:#ff6b6b}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef6;background:linear-gradient(180deg,#071029 0%, #081428 100%);}
  .wrap{max-width:940px;margin:18px auto;padding:16px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#2b6eff,#6b77ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  h1{font-size:18px;margin:0}
  .badge{background:#ffd54d;color:#0b0f1a;padding:6px 8px;border-radius:8px;font-weight:700;font-size:12px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} }
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  .balance{font-size:20px;font-weight:700}
  .small{color:var(--muted);font-size:13px}
  .row{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-top:8px}
  .btn{background:var(--accent);color:#081428;padding:10px 12px;border-radius:10px;border:none;font-weight:700}
  .btn.secondary{background:transparent;color:#cfe6d8;border:1px solid rgba(255,255,255,0.04)}
  .asset{display:flex;align-items:center;gap:12px}
  .coin{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700}
  .btc{background:linear-gradient(135deg,#f2a900,#ffcc66);color:#081428}
  .usdt{background:linear-gradient(135deg,#2abf66,#6be08d);color:#081428}
  .usd{background:linear-gradient(135deg,#9fd3ff,#66b0ff);color:#081428}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .input,select{background:transparent;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);color:#dff0ff}
  .slider{width:100%}
  .tx-list{max-height:260px;overflow:auto;padding-right:8px}
  .tx{display:flex;justify-content:space-between;padding:10px;border-radius:8px;border-bottom:1px dashed rgba(255,255,255,0.02)}
  .muted{color:var(--muted);font-size:13px}
  footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
  .topbar{display:flex;gap:8px;align-items:center}
  .pill{background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:999px;font-weight:600}
  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(5,8,14,0.6), rgba(5,8,14,0.6));z-index:50}
  .modal.open{display:flex}
  .panel{background:var(--card);padding:16px;border-radius:12px;width:min(520px,94%);border:1px solid rgba(255,255,255,0.03)}
  .close{background:transparent;border:0;color:var(--muted);font-weight:700}
  /* tiny */
  .tiny{font-size:12px;color:var(--muted)}
  .status-pending{color:#f59e0b}
  .status-done{color:#34d399}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">DW</div>
      <div>
        <h1>Demo Wallet</h1>
        <div class="tiny">Local sandbox — simulated balances</div>
      </div>
    </div>
    <div class="topbar">
      <div class="badge">DEMO / SANDBOX</div>
      <div class="pill tiny" id="serverTime"></div>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">USD Account</div>
          <div class="balance" id="usdBalance">$0</div>
          <div class="tiny">Account number: 5480-XXXX-XXXX</div>
        </div>
        <div style="text-align:right">
          <div class="small">Available</div>
          <div class="muted tiny" id="usdAvailable">—</div>
          <div style="margin-top:12px">
            <button class="btn" id="btnTransfer">Transfer</button>
            <button class="btn secondary" id="btnWithdraw">Withdraw</button>
          </div>
        </div>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.02)">

      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <div class="asset">
          <div class="coin usd">USD</div>
          <div><div class="small">USD</div><div id="usdVal" class="muted tiny">$1 = $1</div></div>
        </div>

        <div class="asset">
          <div class="coin btc">BTC</div>
          <div><div class="small" id="btcPriceLabel">BTC</div><div id="btcVal" class="muted tiny">—</div></div>
        </div>

        <div class="asset">
          <div class="coin usdt">USDT</div>
          <div><div class="small">USDT</div><div id="usdtVal" class="muted tiny">—</div></div>
        </div>
      </div>

      <div style="margin-top:12px" class="controls">
        <select id="actionSelect" class="input">
          <option value="send">Send USD</option>
          <option value="deposit">Deposit USD</option>
          <option value="swap">Swap USD ↔ Crypto</option>
          <option value="buybtc">Buy BTC (sim)</option>
        </select>
        <input id="amountInput" class="input" type="number" placeholder="Amount (USD)" />
        <input id="range" class="slider" type="range" min="0" max="100" value="5" />
        <button class="btn" id="actionBtn">Execute</button>
      </div>

      <div style="margin-top:10px" class="tiny muted">Tip: use the slider to pick percentage of USD balance for the action.</div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Crypto Balances</div>
          <div style="display:flex;gap:10px;margin-top:8px">
            <div>
              <div class="tiny">BTC</div>
              <div id="btcBal" class="balance">0.00</div>
            </div>
            <div>
              <div class="tiny">USDT</div>
              <div id="usdtBal" class="balance">0.00</div>
            </div>
          </div>
        </div>
        <div>
          <button class="btn" id="btnReceive">Receive</button>
          <button class="btn secondary" id="btnSwap">Swap</button>
        </div>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.02)">

      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div class="tiny muted">Transactions</div>
        <div class="tiny muted">Simulated & local only</div>
      </div>

      <div class="tx-list" id="txList" aria-live="polite" style="margin-top:10px">
        <!-- transactions injected here -->
      </div>
    </div>
  </div>

  <footer>Demo Wallet — sandbox only. Local simulation. No real funds.</footer>
</div>

<!-- modal -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="modalTitle">Action</strong>
      <button class="close" id="closeModal">✕</button>
    </div>
    <div style="margin-top:10px">
      <div class="tiny muted" id="modalDesc">Details</div>
      <div style="margin-top:10px">
        <label class="tiny">Amount</label>
        <input id="modalAmount" class="input" type="number" />
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;">
        <button class="btn" id="modalConfirm">Confirm</button>
        <button class="btn secondary" id="modalCancel">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ====== initial simulated state ======
  const state = {
    usd: 3_250_000_000, // 3.25 billion USD simulated
    btc: 72_000, // BTC price simulated in USD
    usdt: 1.00,
    btcBal: 145.2345,
    usdtBal: 1200000.00,
    tx: []
  };

  // load from localStorage if present
  const saved = localStorage.getItem('demo_wallet_state_v1');
  if(saved){
    try{ Object.assign(state, JSON.parse(saved)); }catch(e){}
  }

  // util
  const $ = id => document.getElementById(id);
  const fmt = (n,dec=2) => Number(n).toLocaleString(undefined,{minimumFractionDigits:dec,maximumFractionDigits:dec});

  // render
  function render(){
    $('usdBalance').textContent = '$' + fmt(state.usd,2);
    $('usdAvailable').textContent = '$' + fmt(state.usd,2);
    $('btcPriceLabel').textContent = 'BTC • $' + fmt(state.btc,0);
    $('btcVal').textContent = '$' + fmt(state.btc,2);
    $('usdtVal').textContent = '1 USDT = $' + fmt(state.usdt,2);
    $('btcBal').textContent = fmt(state.btcBal,6);
    $('usdtBal').textContent = fmt(state.usdtBal,2);
    $('serverTime').textContent = (new Date()).toLocaleString();
    renderTx();
    localStorage.setItem('demo_wallet_state_v1', JSON.stringify(state));
  }

  function addTx(type, amount, asset, status='pending'){
    const t = {id:Date.now()+Math.random(), type, amount, asset, time:new Date().toISOString(), status};
    state.tx.unshift(t);
    // auto-complete pending after a short simulated delay
    setTimeout(()=>{ t.status='done'; render(); }, 900 + Math.random()*1800);
    render();
  }

  function renderTx(){
    const list = $('txList');
    list.innerHTML = '';
    if(state.tx.length===0){
      list.innerHTML = '<div class="tx muted">No transactions yet.</div>';
      return;
    }
    state.tx.forEach(tx=>{
      const div = document.createElement('div');
      div.className='tx';
      div.innerHTML = `<div><div style="font-weight:700">${escapeHtml(tx.type)} ${escapeHtml(tx.asset)}</div><div class="tiny muted">${new Date(tx.time).toLocaleString()}</div></div>
        <div style="text-align:right"><div style="font-weight:700">${tx.asset==="USD"?"$"+fmt(tx.amount,2):fmt(tx.amount,6)}</div><div class="${tx.status==='done'?'status-done':'status-pending'} tiny">${escapeHtml(tx.status)}</div></div>`;
      list.appendChild(div);
    });
  }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // ====== interactions ======
  $('actionSelect').addEventListener('change', ()=>{ $('amountInput').placeholder = $('actionSelect').value.includes('swap') ? 'Amount (USD) or crypto' : 'Amount (USD)'; });
  $('range').addEventListener('input', ()=>{
    const pct = Number($('range').value);
    const amount = Math.max(0, state.usd * pct/100);
    $('amountInput').value = Math.round(amount*100)/100;
  });

  $('actionBtn').addEventListener('click', ()=>{
    const action = $('actionSelect').value;
    const raw = Number($('amountInput').value) || 0;
    if(action === 'send'){
      openModal('Send USD', `Send $${fmt(raw,2)} as a simulated USD transfer.`, raw, confirmSend);
    } else if(action === 'deposit'){
      openModal('Deposit USD', `Simulate depositing $${fmt(raw,2)} to USD account.`, raw, confirmDeposit);
    } else if(action === 'swap'){
      openModal('Swap', `Swap USD to BTC or USDT (simulated). Enter USD amount.`, raw, confirmSwap);
    } else if(action === 'buybtc'){
      openModal('Buy BTC', `Buy BTC with USD (simulated). Enter USD amount.`, raw, confirmBuyBTC);
    }
  });

  $('btnTransfer').addEventListener('click', ()=> openModal('Quick Transfer','Send a simulated USD transfer',1000,confirmSend));
  $('btnWithdraw').addEventListener('click', ()=> openModal('Withdraw','Simulated withdraw (no real movement).',50000,confirmWithdraw));
  $('btnReceive').addEventListener('click', ()=> {
    // simulate receiving funds
    const amt = Math.round((Math.random()*50000+1000)*100)/100;
    state.usd += amt;
    addTx('Receive', amt, 'USD');
    render();
  });
  $('btnSwap').addEventListener('click', ()=> openModal('Swap USD→USDT','Quick swap USD to USDT (1:1 sim).',1000,confirmSwap));
  $('closeModal').addEventListener('click', closeModal);
  $('modalCancel').addEventListener('click', closeModal);

  function openModal(title, desc, amount, cb){
    $('modalTitle').textContent = title;
    $('modalDesc').textContent = desc;
    $('modalAmount').value = amount || '';
    $('modalConfirm').onclick = function(){ cb(Number($('modalAmount').value || 0)); closeModal(); };
    $('modal').classList.add('open');
  }
  function closeModal(){ $('modal').classList.remove('open'); }

  // confirm handlers
  function confirmSend(amount){
    if(amount<=0) return alert('Enter an amount > 0');
    if(amount > state.usd) return alert('Insufficient simulated USD balance.');
    state.usd -= amount;
    addTx('Send', amount, 'USD');
    render();
  }
  function confirmDeposit(amount){
    if(amount<=0) return alert('Enter an amount > 0');
    state.usd += amount;
    addTx('Deposit', amount, 'USD');
    render();
  }
  function confirmWithdraw(amount){
    if(amount<=0) return alert('Enter an amount > 0');
    if(amount > state.usd) return alert('Insufficient simulated USD balance.');
    state.usd -= amount;
    addTx('Withdraw', amount, 'USD');
    render();
  }
  function confirmSwap(amount){
    if(amount<=0) return alert('Enter an amount > 0');
    if(amount > state.usd) return alert('Insufficient simulated USD balance.');
    // simple: convert USD -> USDT 1:1
    state.usd -= amount;
    state.usdtBal += amount / state.usdt;
    addTx('Swap USD→USDT', amount, 'USDT');
    render();
  }
  function confirmBuyBTC(amount){
    if(amount<=0) return alert('Enter an amount > 0');
    if(amount > state.usd) return alert('Insufficient simulated USD balance.');
    const btcAmount = amount / state.btc;
    state.usd -= amount;
    state.btcBal += btcAmount;
    addTx('Buy BTC', btcAmount, 'BTC');
    render();
  }

  // small price simulator
  setInterval(()=>{
    // random walk BTC, keep USDT=1
    const delta = (Math.random()-0.5)*500; // small moves
    state.btc = Math.max(1000, Math.round((state.btc + delta)));
    render();
  }, 3500);

  // keyboard friendly
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape') closeModal();
  });

  // initialize
  render();

  // expose debug in window for tinkering (local) only
  window.__demo_wallet = {state, addTx, render};

})();
</script>
</body>
</html>
